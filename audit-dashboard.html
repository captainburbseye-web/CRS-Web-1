<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRS Audit Dashboard - Website Monitoring</title>
  <style>
    /* CRS Audit Dashboard - NASA Terminal Aesthetic */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* OKLCH Color Palette */
      --bg-primary: oklch(0.1 0.02 150);
      --bg-card: oklch(0.15 0.03 150);
      --border: oklch(0.25 0.03 150);
      --text-primary: oklch(1 0 0);
      --text-secondary: oklch(0.7 0.01 150);
      --accent-orange: oklch(0.65 0.18 75);
      --status-healthy: oklch(0.85 0.25 145);
      --status-warning: oklch(0.75 0.18 85);
      --status-error: oklch(0.55 0.22 29);
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 2rem;
      line-height: 1.6;
    }

    .header {
      margin-bottom: 3rem;
      border-bottom: 2px solid var(--accent-orange);
      padding-bottom: 1.5rem;
    }

    h1 {
      font-family: 'Courier New', monospace;
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-orange);
      letter-spacing: 0.05em;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-family: 'Courier New', monospace;
    }

    .controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      align-items: center;
    }

    .button {
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 0.5rem 1rem;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .button:hover {
      background: var(--border);
      border-color: var(--accent-orange);
    }

    .button.active {
      background: var(--accent-orange);
      color: var(--bg-primary);
      border-color: var(--accent-orange);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 1.5rem;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }

    .card-title {
      font-family: 'Courier New', monospace;
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-primary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .status {
      font-family: 'Courier New', monospace;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 0.25rem 0.5rem;
      text-transform: uppercase;
    }

    .status.healthy {
      color: var(--status-healthy);
      border: 1px solid var(--status-healthy);
    }

    .status.warning {
      color: var(--status-warning);
      border: 1px solid var(--status-warning);
    }

    .status.error {
      color: var(--status-error);
      border: 1px solid var(--status-error);
    }

    .metric {
      display: flex;
      justify-content: space-between;
      font-size: 0.875rem;
      margin: 0.5rem 0;
    }

    .metric-label {
      color: var(--text-secondary);
    }

    .metric-value {
      font-family: 'Courier New', monospace;
      font-weight: 600;
    }

    .timestamp {
      text-align: center;
      margin-top: 3rem;
      color: var(--text-secondary);
      font-size: 0.75rem;
      font-family: 'Courier New', monospace;
    }

    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>CRS Audit Dashboard</h1>
    <div class="subtitle">Website Monitoring • cowleyroadstudios.com</div>
  </div>

  <div class="controls">
    <button class="button" onclick="runAudit()">▶ Run Audit</button>
    <button class="button" onclick="toggleAutoRefresh()" id="autoRefreshBtn">Auto-refresh: OFF</button>
    <select class="button" id="refreshInterval">
      <option value="30">30 seconds</option>
      <option value="60" selected>1 minute</option>
      <option value="300">5 minutes</option>
      <option value="600">10 minutes</option>
    </select>
  </div>

  <div id="dashboard" class="grid">
    <div class="loading">Click "Run Audit" to start monitoring</div>
  </div>

  <div class="timestamp" id="timestamp"></div>

  <script>
    const BASE_URL = 'https://cowleyroadstudios.com';
    let autoRefreshInterval = null;

    const endpoints = [
      { name: 'Homepage', url: '/', type: 'page' },
      { name: 'Studio', url: '/studio', type: 'page' },
      { name: 'Workshop Café', url: '/workshop-cafe', type: 'page' },
      { name: 'AV Services', url: '/av-services', type: 'page' },
      { name: 'Infrastructure', url: '/locations', type: 'page' },
      { name: 'Contact', url: '/contact', type: 'page' },
      { name: 'Contact API', url: '/api/contact', type: 'api' },
      { name: 'Studio Booking API', url: '/api/book/studio', type: 'api' },
      { name: 'Venue Booking API', url: '/api/book/venue', type: 'api' }
    ];

    async function testEndpoint(endpoint) {
      const start = performance.now();
      try {
        const response = await fetch(BASE_URL + endpoint.url, {
          method: 'HEAD',
          cache: 'no-cache'
        });
        const time = Math.round(performance.now() - start);
        
        return {
          name: endpoint.name,
          url: endpoint.url,
          type: endpoint.type,
          status: response.status,
          statusText: response.statusText,
          time: time,
          healthy: response.status >= 200 && response.status < 400
        };
      } catch (error) {
        const time = Math.round(performance.now() - start);
        return {
          name: endpoint.name,
          url: endpoint.url,
          type: endpoint.type,
          status: 0,
          statusText: error.message,
          time: time,
          healthy: false
        };
      }
    }

    async function runAudit() {
      document.getElementById('dashboard').innerHTML = '<div class="loading">Running audit...</div>';
      
      const results = await Promise.all(endpoints.map(testEndpoint));
      
      renderDashboard(results);
      updateTimestamp();
    }

    function renderDashboard(results) {
      const html = results.map(result => {
        let statusClass = 'error';
        let statusText = 'ERROR';
        
        if (result.healthy) {
          if (result.time < 500) {
            statusClass = 'healthy';
            statusText = 'HEALTHY';
          } else {
            statusClass = 'warning';
            statusText = 'SLOW';
          }
        }

        return `
          <div class="card">
            <div class="card-header">
              <div class="card-title">${result.name}</div>
              <div class="status ${statusClass}">${statusText}</div>
            </div>
            <div class="metric">
              <span class="metric-label">URL</span>
              <span class="metric-value">${result.url}</span>
            </div>
            <div class="metric">
              <span class="metric-label">HTTP Status</span>
              <span class="metric-value">${result.status} ${result.statusText}</span>
            </div>
            <div class="metric">
              <span class="metric-label">Response Time</span>
              <span class="metric-value">${result.time}ms</span>
            </div>
            <div class="metric">
              <span class="metric-label">Type</span>
              <span class="metric-value">${result.type.toUpperCase()}</span>
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('dashboard').innerHTML = html;
    }

    function updateTimestamp() {
      const now = new Date();
      document.getElementById('timestamp').textContent = 
        `Last updated: ${now.toLocaleString('en-GB', { 
          day: '2-digit', 
          month: 'short', 
          year: 'numeric', 
          hour: '2-digit', 
          minute: '2-digit', 
          second: '2-digit' 
        })}`;
    }

    function toggleAutoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
        document.getElementById('autoRefreshBtn').textContent = 'Auto-refresh: OFF';
        document.getElementById('autoRefreshBtn').classList.remove('active');
      } else {
        const interval = parseInt(document.getElementById('refreshInterval').value) * 1000;
        autoRefreshInterval = setInterval(runAudit, interval);
        document.getElementById('autoRefreshBtn').textContent = 'Auto-refresh: ON';
        document.getElementById('autoRefreshBtn').classList.add('active');
        runAudit();
      }
    }

    // Initial audit on load
    runAudit();
  </script>
</body>
</html>
